{"version":3,"file":"static/js/563.ea254a51.chunk.js","mappings":"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","sources":["components/puzzle/pieces.js"],"sourcesContent":["import { useRef, useEffect } from 'react'\nimport { TransformWrapper, TransformComponent } from 'react-zoom-pan-pinch'\n\nimport { select, selectAll } from 'd3-selection'\nimport { geoAlbersUsa, geoPath } from 'd3-geo'\nimport { drag } from 'd3-drag'\nimport { feature } from 'topojson-client'\n\nimport { stateDictionary } from '../../dictionaries/state'\nimport { stateId } from '../utilities'\n\nconst Pieces = ({\n  countyGeometry,\n  stateGeometry,\n  baseTopology,\n  stateFilter,\n  handleMouseMove,\n  handleMouseOut,\n  handleMouseOver,\n  setTooltipText,\n  updateTranslations\n}) => {\n  const mapRef = useRef()\n  const transformRef = useRef()\n\n  const transformUtility = (target, withReturn = true) => {\n    const [x, y] = target.attr('transform').match(/-?\\d+(\\.\\d+)?/g)\n    if (Math.abs(+x) < 0.25 && Math.abs(+y) < 0.25) {\n      target.attr('transform', 'translate(0,0)')\n      located(target)\n      if (withReturn) return [0, 0]\n    } else if (withReturn) return [+x, +y]\n  }\n\n  const located = (target) => {\n    target\n      .attr('stroke-width', 0.1)\n      .attr('stroke', 'lightgray')\n      .attr('fill', 'slategray')\n      .on('.drag', null)\n      .lower()\n    select(`#state-${target.attr('state-id')}`).lower()\n  }\n\n  const dragHandler = drag()\n    .on('start', function () {\n      setTooltipText('')\n      select(this).raise()\n      selectAll('.county').attr('pointer-events', 'none')\n    })\n    .on('drag', function ({ dx, dy }) {\n      const { e: startX, f: startY } = select(this).node().transform.baseVal[0].matrix\n      select(this).attr('transform', `translate(${startX + dx},${startY + dy})`)\n    })\n    .on('end', function (d) {\n      updateTranslations(d.subject.id, transformUtility(select(this)))\n      selectAll('.county').attr('pointer-events', 'all')\n    })\n\n  useEffect(() => {\n    // remove any svg el from previous render\n    select(mapRef.current).selectAll('*').remove()\n\n    const width = window.outerWidth\n    const height = window.innerHeight\n\n    const counties = { type: 'GeometryCollection', geometries: countyGeometry }\n    const states = { type: 'GeometryCollection', geometries: stateGeometry }\n\n    // geoAlbersUSA projection, center on window/svg\n    const projection = geoAlbersUsa()\n      .translate([width / 2, height / 2])\n      .scale(900)\n\n    // Create a path generator that converts GeoJSON geometries to SVG path elements\n    const pathGenerator = geoPath().projection(projection)\n\n    const svg = select(mapRef.current)\n      .append('svg')\n      .attr('width', width)\n      .attr('height', height)\n      .attr('viewBox', `0 0 ${width} ${height}`)\n\n    svg\n      .selectAll('.state')\n      .data(feature(baseTopology, states).features)\n      .enter()\n      .append('path')\n      .attr('class', 'state')\n      .attr('d', pathGenerator)\n      .attr('fill', ({ id }) => stateDictionary[id].color)\n      .attr('id', ({ id }) => `state-${id}`)\n\n    // Create a path element for each count\n    const countyPaths = svg\n      .selectAll('.county')\n      .data(feature(baseTopology, counties).features)\n      .enter()\n      .append('path')\n      .attr('class', 'county')\n      .attr('d', pathGenerator)\n      .attr('stroke', ({ id }) => stateDictionary[stateId(id)].color)\n      .attr('stroke-width', 0.15)\n      .attr('fill', 'lightgray')\n      .attr('id', ({ id }) => `county-${id}`)\n      .attr('state-id', ({ id }) => `${stateId(id)}`)\n      .attr('data-name', ({ properties }) => `${properties.name}`)\n      .attr('is-hidden', false)\n      .attr(\n        'transform',\n        ({\n          properties: {\n            transpose: [x, y]\n          }\n        }) => `translate(${x}, ${y})`\n      )\n      .on('mouseover', function (e, d) {\n        if (select(this).attr('is-hidden') === 'false') {\n          handleMouseOver(e, d)\n        }\n      })\n      .on('mousemove', (e) => handleMouseMove(e))\n      .on('mouseout', handleMouseOut)\n\n    countyPaths.call(dragHandler).each(function () {\n      transformUtility(select(this), false)\n    })\n  }, [countyGeometry])\n\n  useEffect(() => {\n    if (stateFilter) {\n      const node = select(`#state-${stateFilter}`).node()\n      transformRef.current.zoomToElement(node, 2, 500, 'easeOut')\n    } else {\n      transformRef.current.resetTransform(500, 'easeOut')\n    }\n\n    selectAll('.county, .state')\n      .style('visibility', 'visible')\n      .attr('pointer-events', 'all')\n      .attr('is-hidden', false)\n    if (stateFilter.length) {\n      selectAll('.county, .state')\n        .filter(({ id }) => (stateFilter.includes(stateId(id)) ? false : true))\n        .style('visibility', 'hidden')\n        .attr('pointer-events', 'none')\n        .attr('is-hidden', true)\n    }\n  }, [stateFilter, countyGeometry])\n\n  return (\n    <TransformWrapper ref={transformRef}>\n      <TransformComponent>\n        <div ref={mapRef} className=\"pieces\"></div>\n      </TransformComponent>\n    </TransformWrapper>\n  )\n}\n\nexport default Pieces\n"],"names":["_ref","countyGeometry","stateGeometry","baseTopology","stateFilter","handleMouseMove","handleMouseOut","handleMouseOver","setTooltipText","updateTranslations","mapRef","useRef","transformRef","transformUtility","target","withReturn","arguments","length","undefined","_target$attr$match","attr","match","_target$attr$match2","_slicedToArray","x","y","Math","abs","located","on","lower","select","concat","dragHandler","drag","this","raise","selectAll","_ref2","dx","dy","_select$node$transfor","node","transform","baseVal","matrix","startX","e","startY","f","d","subject","id","useEffect","current","remove","width","window","outerWidth","height","innerHeight","counties","type","geometries","states","projection","geoAlbersUsa","translate","scale","pathGenerator","geoPath","svg","append","data","feature","features","enter","_ref3","stateDictionary","color","_ref4","_ref5","stateId","_ref6","_ref7","_ref8","properties","name","_ref9","_ref9$properties$tran","transpose","call","each","zoomToElement","resetTransform","style","filter","_ref10","includes","_jsx","TransformWrapper","ref","children","TransformComponent","className"],"sourceRoot":""}