{"version":3,"file":"static/js/992.c8e893e4.chunk.js","mappings":"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","sources":["components/puzzle/svgUtilities.js","components/puzzle/svgPieces.js"],"sourcesContent":["import { select, selectAll } from 'd3-selection'\nimport { stateId } from '../utilities'\n\n// pass a d3 selection, applys 'located' attributes\n// lowers the county to the bottom then lowers the state to bottom\nconst applyLocatedAttr = (selection) => {\n  selection\n    .attr('transform', 'translate(0,0)')\n    .attr('stroke-width', 0.1)\n    .attr('stroke', 'lightgray')\n    .attr('fill', 'slategray')\n    .on('.drag', null)\n    .lower()\n\n  select(`#state-${selection.attr('state-id')}`).lower()\n}\n\n// checks if target's transform values are within threshold to be considered located\n// optionally returns the x, y values as number\nexport const transformUtility = (selection, withReturn = true) => {\n  const threshold = 0.75\n  const [x, y] = selection.attr('transform').match(/-?\\d+(\\.\\d+)?/g)\n  if (Math.abs(+x) < threshold && Math.abs(+y) < threshold) {\n    applyLocatedAttr(selection)\n    if (withReturn) return [0, 0]\n  } else if (withReturn) return [+x, +y]\n}\n\n// sets visibility attributes of counties by state\nexport const filterStates = (stateFilter) => {\n  selectAll('.county, .state')\n    .style('visibility', 'visible')\n    .attr('pointer-events', 'all')\n    .attr('is-hidden', false)\n  if (stateFilter) {\n    selectAll('.county, .state')\n      .filter(({ id }) => (stateFilter.includes(stateId(id)) ? false : true))\n      .style('visibility', 'hidden')\n      .attr('pointer-events', 'none')\n      .attr('is-hidden', true)\n  }\n}\n// if state filter is selected, update zoom pan pinch to state node coords\nexport const updateZoom = (transformRef, stateFilter) => {\n  if (stateFilter) {\n    const node = select(`#state-${stateFilter}`).node()\n    transformRef.current.zoomToElement(node, 2, 500, 'easeOut')\n  } else {\n    transformRef.current.resetTransform(500, 'easeOut')\n  }\n}\n","import { useRef, useEffect } from 'react'\nimport { TransformWrapper, TransformComponent } from 'react-zoom-pan-pinch'\nimport { browserName } from 'react-device-detect'\nimport { select, selectAll } from 'd3-selection'\nimport { geoAlbersUsa, geoPath } from 'd3-geo'\nimport { drag } from 'd3-drag'\nimport { feature } from 'topojson-client'\nimport { stateDictionary } from '../../dictionaries/state'\nimport { stateId } from '../utilities'\nimport { transformUtility, filterStates, updateZoom } from './svgUtilities'\n\nconst Pieces = ({\n  countyGeometry,\n  stateGeometry,\n  baseTopology,\n  stateFilter,\n  handlers,\n  setTooltipText,\n  updateTranslations\n}) => {\n  const mapRef = useRef()\n  const transformRef = useRef()\n\n  // chrome is automatically factoring in the scale factor from zoom pan pinch\n  // the zoom factor needs to be accounted for when dragging\n  const dragHandlerChrome = drag()\n    .on('start', function () {\n      setTooltipText('')\n      select(this).raise()\n      selectAll('.county').attr('pointer-events', 'none')\n    })\n    .on('drag', function ({ dx, dy }) {\n      const { e: startX, f: startY } = select(this).node().transform.baseVal[0].matrix\n      select(this).attr('transform', `translate(${startX + dx},${startY + dy})`)\n    })\n    .on('end', function ({ subject }) {\n      updateTranslations(subject.id, transformUtility(select(this)))\n      selectAll('.county').attr('pointer-events', 'all')\n    })\n\n  // firefox needs the zoom factor from zoom pan pinch to be factored in manually\n  // the zoom factor needs to be accounted for when dragging\n  const dragHandlerFirefox = drag()\n    .on('start', function () {\n      setTooltipText('')\n      select(this).raise()\n      selectAll('.county').attr('pointer-events', 'none')\n    })\n    .on('drag', function ({ dx, dy }) {\n      const transformMatrix = select(this).node().transform.baseVal[0].matrix\n      const { e: translateX, f: translateY, a: scaleX, d: scaleY } = transformMatrix\n      // get scale from react zoom pan pinch\n      const zoomScale = transformRef.current.instance.transformState.scale\n      // Calculate the scaled translation\n      const scaledDx = dx / scaleX / zoomScale\n      const scaledDy = dy / scaleY / zoomScale\n      // calculate the new coords\n      const newX = translateX + scaledDx\n      const newY = translateY + scaledDy\n\n      select(this).attr('transform', `translate(${newX},${newY})`)\n    })\n    .on('end', function ({ subject }) {\n      updateTranslations(subject.id, transformUtility(select(this)))\n      selectAll('.county').attr('pointer-events', 'all')\n    })\n\n  useEffect(() => {\n    // remove any svg el from previous render\n    select(mapRef.current).selectAll('*').remove()\n\n    const width = window.outerWidth\n    const height = window.outerHeight\n\n    const counties = { type: 'GeometryCollection', geometries: countyGeometry }\n    const states = { type: 'GeometryCollection', geometries: stateGeometry }\n\n    // geoAlbersUSA projection, center on window/svg\n    const projection = geoAlbersUsa()\n      .translate([width / 2, height / 2])\n      .scale(900)\n\n    // Create a path generator that converts GeoJSON geometries to SVG path elements\n    const pathGenerator = geoPath().projection(projection)\n\n    const svg = select(mapRef.current)\n      .append('svg')\n      .attr('width', width)\n      .attr('height', height)\n      .attr('viewBox', `0 0 ${width} ${height}`)\n\n    svg\n      .selectAll('.state')\n      .data(feature(baseTopology, states).features)\n      .enter()\n      .append('path')\n      .attr('class', 'state')\n      .attr('d', pathGenerator)\n      .attr('fill', ({ id }) => stateDictionary[id].color)\n      .attr('id', ({ id }) => `state-${id}`)\n\n    // Create a path element for each count\n    const countyPaths = svg\n      .selectAll('.county')\n      .data(feature(baseTopology, counties).features)\n      .enter()\n      .append('path')\n      .attr('class', 'county')\n      .attr('d', pathGenerator)\n      .attr('stroke', ({ id }) => stateDictionary[stateId(id)].color)\n      .attr('stroke-width', 0.15)\n      .attr('fill', 'lightgray')\n      .attr('id', ({ id }) => `county-${id}`)\n      .attr('state-id', ({ id }) => `${stateId(id)}`)\n      .attr('data-name', ({ properties }) => `${properties.name}`)\n      .attr('is-hidden', false)\n      .attr(\n        'transform',\n        ({\n          properties: {\n            transpose: [x, y]\n          }\n        }) => `translate(${x}, ${y})`\n      )\n      .on('mouseover', function ({ pageX, pageY }, { properties }) {\n        if (select(this).attr('is-hidden') === 'false') {\n          handlers.mouseOver(pageX, pageY, properties)\n        }\n      })\n      .on('mousemove', ({ pageX, pageY }) => handlers.mouseMove(pageX, pageY))\n      .on('mouseout', () => handlers.mouseOut())\n\n    const dragHandler = browserName === 'Chrome' ? dragHandlerChrome : dragHandlerFirefox\n\n    countyPaths.call(dragHandler).each(function () {\n      transformUtility(select(this), false)\n    })\n  }, [countyGeometry])\n\n  useEffect(() => {\n    filterStates(stateFilter)\n    updateZoom(transformRef, stateFilter)\n  }, [stateFilter, countyGeometry])\n\n  return (\n    <TransformWrapper ref={transformRef}>\n      <TransformComponent>\n        <div ref={mapRef} className=\"pieces\"></div>\n      </TransformComponent>\n    </TransformWrapper>\n  )\n}\n\nexport default Pieces\n"],"names":["applyLocatedAttr","selection","attr","on","lower","select","concat","transformUtility","withReturn","arguments","length","undefined","_selection$attr$match","match","_selection$attr$match2","_slicedToArray","x","y","Math","abs","_ref","countyGeometry","stateGeometry","baseTopology","stateFilter","handlers","setTooltipText","updateTranslations","mapRef","useRef","transformRef","dragHandlerChrome","drag","this","raise","selectAll","_ref2","dx","dy","_select$node$transfor","node","transform","baseVal","matrix","startX","e","startY","f","_ref3","subject","id","dragHandlerFirefox","_ref4","transformMatrix","translateX","translateY","scaleX","a","scaleY","d","zoomScale","current","instance","transformState","scale","newX","newY","_ref5","useEffect","remove","width","window","outerWidth","height","outerHeight","counties","type","geometries","states","projection","geoAlbersUsa","translate","pathGenerator","geoPath","svg","append","data","feature","features","enter","_ref6","stateDictionary","color","_ref7","countyPaths","_ref8","stateId","_ref9","_ref10","_ref11","properties","name","_ref12","_ref12$properties$tra","transpose","_ref13","_ref14","pageX","pageY","mouseOver","_ref15","mouseMove","mouseOut","dragHandler","browserName","call","each","style","filter","includes","filterStates","zoomToElement","resetTransform","updateZoom","_jsx","TransformWrapper","ref","children","TransformComponent","className"],"sourceRoot":""}